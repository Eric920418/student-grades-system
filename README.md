# 學生成績管理系統

一個功能完整的多課程學生分組與成績管理工具，支援多個課程同時管理。使用 Next.js + Tailwind CSS + PostgreSQL (Neon) 建立，可部署至 Vercel。

## 功能特色

### 📚 多課程管理
- **課程選擇**：首頁可選擇不同課程進入管理
- **課程分離**：學生、分組、成績項目都按課程分離
- **現有課程**：3D電腦繪圖、互動投影
- **擴展性**：可輕鬆新增更多課程

### 🎓 學生管理
- 新增、編輯、刪除學生資料
- 支援學號、姓名、Email、班級、課程資訊
- **AB班級分類**：支援A班/B班分類管理
- **班級篩選器**：可依班級快速篩選學生
- **課程關聯**：每位學生都屬於特定課程
- 學號唯一性驗證

### 👥 分組管理
- 建立多個學生分組（按課程分離）
- **選人分組**：新增分組時直接選擇學生，無需分組名稱和描述
- **快速搜尋**：支援姓名或學號搜尋，快速找到目標學生
- **唯一性限制**：每位學生在同一課程內只能加入一個組別
- **職位分配**：為分組成員分配職位（導演、模型、後製、動畫、企劃、美術）
- **組長指派**：可指定任意成員為組長，第一個選擇的學生預設為組長
- **視覺化顯示**：組長以黃色背景標示，各成員職位以標籤顯示
- **自動命名**：系統自動生成分組名稱，格式：第X組（自動遞增編號）
- **課程關聯**：每個分組都屬於特定課程

### 📊 成績項目管理
- 建立多種評分項目（期中考、期末考、作業等）
- 設定各項目權重比例
- 自定義滿分標準
- **課程關聯**：每個成績項目都屬於特定課程
- **刪除功能**：可刪除不需要的成績項目（會同時刪除相關成績記錄）
- **詳細檢視**：點擊查看詳情可查看：
  - 成績項目基本資訊（權重、滿分、創建時間）
  - 統計資訊（已登記人數、平均分數、最高分、最低分）
  - 成績分布圖表（A/B/C/D/F等第分布）
  - 完整的學生成績列表（含學號、姓名、班級、分數、等第、百分比）
- **📥 Excel 成績導出**：
  - 支援自訂範本格式導出
  - 上傳你的 Excel 範本檔案（必須包含「學號」欄位）
  - 系統自動識別學號欄位並填入對應成績
  - 如範本無成績欄位，系統自動添加
  - 保持原始範本不變，下載全新檔案
  - 支援 .xls 和 .xlsx 格式
  - 顯示導出統計資訊（成功填入數量、未找到的學號等）

### ✍️ 成績登記
- **成績項目選擇**：從下拉選單選擇要登記的項目，每次專注登記一個項目
- **雙模式成績登記**：支援個人模式和分組模式
- **個人模式**：
  - 簡潔的三欄表格：學號/姓名、該項目成績、總成績
  - 點擊「點擊登記」按鈕輸入分數
  - 即時驗證分數範圍
  - 顯示每位學生的總成績（所有項目加權平均）
- **分組模式**：
  - 顯示每個分組的成員名單
  - 以分組為單位批次給成績
  - 一次輸入，整組成員獲得相同成績
  - **🔍 學號查組**：輸入學號快速找到對應組別，匹配的學號會以黃色高亮顯示
  - **智能過濾**：已評分完成的組別會自動從列表中隱藏，避免重複評分
  - 所有組別評分完成後會顯示友善提示
  - 適合團隊作業、專題報告等情境
  - 大幅提升成績登記效率

### 🏆 總成績計算
- **自動化權重計算**：總成績 = Σ(各項目分數/滿分 × 100 × 權重) ÷ Σ權重
- 即時更新總分顯示
- 成績等第顏色標示

## 技術架構

- **前端框架**：Next.js 14 (App Router)
- **樣式框架**：Tailwind CSS
- **資料庫**：PostgreSQL (Neon) + Prisma ORM
- **開發工具**：TypeScript + ESLint
- **包管理**：pnpm
- **部署平台**：Vercel

## 快速開始

### 安裝依賴
```bash
pnpm install
```

### 環境變數設置
複製 `.env.example` 為 `.env` 並填入 Neon 資料庫連接字串：
```bash
cp .env.example .env
```

編輯 `.env` 文件：
```
DATABASE_URL="postgresql://username:password@host/database?sslmode=require"
```

### Excel學生名單匯入
系統提供專用腳本匯入Excel格式的學生名單：

```bash
# 匯入互動投影A班學生（從元智大學修課名單）
node scripts/import-interactive-a.js
```

**匯入功能特色：**
- **智能解析**：自動識別Excel中的學號、姓名欄位
- **標題行過濾**：自動跳過標題行，避免資料污染
- **重複檢測**：檢查學號是否已存在，避免重複匯入
- **課程關聯**：自動關聯到對應課程，若課程不存在會自動創建
- **詳細報告**：顯示匯入成功、跳過、失敗的詳細統計

### 初始化資料庫
```bash
pnpm prisma generate
pnpm prisma db push
```

### 啟動開發伺服器
```bash
pnpm dev
```

系統將運行在 http://localhost:3000

### 建構生產版本
```bash
pnpm build
pnpm start
```

## 資料庫結構

### 課程表 (courses)
- `id`: 唯一識別碼
- `name`: 課程名稱 (唯一)
- `code`: 課程代碼 (選填)
- `description`: 課程描述 (選填)

### 學生表 (students)
- `id`: 唯一識別碼
- `name`: 學生姓名
- `studentId`: 學號 (唯一)
- `email`: Email 地址 (選填)
- `class`: 班級 (A班/B班，默認為A班)
- `courseId`: 所屬課程 ID (外鍵)

### 分組表 (groups)
- `id`: 唯一識別碼
- `name`: 分組名稱 (同一課程內唯一)
- `description`: 分組描述 (選填)
- `courseId`: 所屬課程 ID (外鍵)

### 學生分組關係表 (student_groups)
- `studentId`: 學生ID (外鍵)
- `groupId`: 分組ID (外鍵)
- `role`: 職位 (選填：導演/模型/後製/動畫/企劃/美術)

### 成績項目表 (grade_items)
- `id`: 唯一識別碼
- `name`: 項目名稱 (同一課程內唯一)
- `weight`: 權重 (0-1)
- `maxScore`: 滿分
- `courseId`: 所屬課程 ID (外鍵)

### 成績表 (grades)
- `studentId`: 學生ID (外鍵)
- `gradeItemId`: 成績項目ID (外鍵)
- `score`: 分數

## 使用說明

### 1. 課程選擇
1. 於首頁選擇要管理的課程（目前支援：3D電腦繪圖、互動投影）
2. 点击課程卡片選擇要管理的課程
3. 選擇後可看到該課程的系統功能入口

### 2. 學生管理
1. 進入「學生管理」新增學生資料
   - 填寫姓名、學號、Email（選填）
   - 選擇班級（A班或B班）
   - 系統會自動關聯到當前選擇的課程
2. 使用班級篩選器可快速查看特定班級學生

### 3. 成績設定
1. **重要：必須從首頁選擇課程後進入**
   - 在首頁點擊要管理的課程（如：3D電腦繪圖）
   - 再點擊「成績項目」卡片
2. 建立評分項目和權重
   - 項目名稱（如：期中考、期末考）
   - 權重（用於總成績計算）
   - 滿分（預設 100 分）
3. **注意：成績項目會自動關聯到當前選擇的課程**

### 4. 分組管理（選用）
1. 進入「分組管理」→「新增分組」
2. 從左側學生列表選擇要加入分組的學生
   - 只會顯示當前課程的學生
   - **快速搜尋**：可輸入姓名或學號快速篩選學生
   - 第一個選擇的學生會自動設為組長
3. 在右側分組成員區域：
   - 為每位學生選擇職位（導演、模型、後製、動畫、企劃、美術）
   - 點擊「設為組長」可重新指派組長
   - 組長會以黃色背景標示
4. 系統會自動生成分組名稱（第1組、第2組...），無需手動輸入

### 5. 成績登記
1. 進入「成績登記」頁面
2. **步驟 1：選擇要登記的成績項目**
   - 從下拉選單選擇要登記的項目（期中考、期末考、作業等）
   - 每次只登記一個項目，避免混亂
3. **步驟 2：選擇登記模式**
   - **個人模式**：逐一為每位學生登記成績
     - 點擊「點擊登記」按鈕輸入分數
     - 表格顯示：學號/姓名、該項目成績、總成績
     - 可查看每位學生的總成績（所有項目加權平均）
   - **分組模式**：批次為整組登記成績
     - 顯示每個分組的成員名單
     - 🔍 **學號查組**：輸入學號可快速找到該學生所在的組別
     - 匹配的學號會以黃色高亮顯示
     - 點擊「給整組評分」按鈕
     - 輸入分數後，整組成員都會獲得相同成績
     - **已評分的組別會自動消失**，避免重複評分
     - 所有組別完成評分後會顯示提示訊息
     - 適合團隊作業、專題報告等情境
4. 系統自動計算並顯示總成績（個人模式）

### 4. 總成績計算邏輯
- 每個項目分數會先正規化為百分比：`(實得分數 ÷ 滿分) × 100`
- 再根據權重計算：`總成績 = Σ(正規化分數 × 權重) ÷ Σ權重`
- 例如：期中考60/100 (權重30%)、期末考80/100 (權重70%) → 總成績 = (60×0.3 + 80×0.7) ÷ (0.3+0.7) = 74分

### 5. Excel 成績導出
1. 進入成績項目詳情頁面
2. 在「📊 導出成績到 Excel」區塊
3. 點擊「選擇 Excel 範本檔案」上傳你的範本
   - 範本必須包含「學號」欄位（支援多種命名：學號、StudentID、Student ID、ID 等）
   - 可以是學校提供的固定格式表格
   - 支援 .xls 和 .xlsx 格式
4. 選擇檔案後，點擊「🎯 開始導出成績」
5. 系統會自動：
   - 讀取範本檔案
   - 識別學號欄位位置
   - 查找成績欄位（如果沒有則自動添加新欄位）
   - 根據學號填入對應成績
   - 生成新檔案供下載
6. 查看導出結果統計
   - 顯示成功填入的學生數量
   - 列出範本中有但系統中找不到成績的學號

## 開發者資訊

### API 路由
- `GET/POST /api/students` - 學生管理
  - `GET /api/students?class=A&courseId=xxx` - 依班級和課程篩選學生
- `GET/POST /api/groups` - 分組管理
  - `GET /api/groups?courseId=xxx` - 按課程篩選分組
  - `POST /api/groups` - 新增分組（新格式）
    - 接受格式：`{ courseId: string, students: [{ studentId: string, role: string }] }`
    - 系統自動生成分組名稱（第1組、第2組...）
- `POST /api/groups/[id]/students` - 學生分組分配（支援職位）
  - 接受格式：`{ students: [{ id: string, role?: string }] }`
- `GET/POST /api/grade-items` - 成績項目管理
  - `GET /api/grade-items?courseId=xxx` - 獲取成績項目列表
    - **必填參數**：`courseId`（課程ID）
    - 返回指定課程的所有成績項目
  - `POST /api/grade-items` - 新增成績項目
    - **必填欄位**：`name`（項目名稱）、`courseId`（課程ID）
    - **選填欄位**：`weight`（權重，0-1，預設1.0）、`maxScore`（滿分，預設100.0）
    - **唯一性檢查**：同一課程內，項目名稱必須唯一
    - 接受格式：`{ name: string, courseId: string, weight?: number, maxScore?: number }`
- `GET/DELETE /api/grade-items/[id]` - 單一成績項目操作
  - `GET /api/grade-items/[id]` - 獲取單一成績項目詳細信息
    - 返回成績項目基本資訊、所屬課程、完整成績列表（含學生資料）
  - `DELETE /api/grade-items/[id]` - 刪除成績項目
    - 會級聯刪除所有相關的成績記錄
    - 返回刪除成功訊息和被刪除的成績記錄數量
- `POST /api/grade-items/[id]/export` - Excel 成績導出
  - **上傳範本並導出成績到 Excel**
  - 接受格式：`FormData` with `template` field (File)
  - 功能：
    - 讀取上傳的 Excel 範本檔案
    - 自動識別學號欄位（支援：學號、StudentID、Student ID、ID 等）
    - 自動識別或創建成績欄位
    - 根據學號填入對應成績
    - 返回新的 Excel 檔案供下載
  - 返回標頭：
    - `X-Updated-Count`：成功填入成績的學生數量
    - `X-Not-Found-Students`：範本中有但系統找不到成績的學號列表
- `GET/POST /api/grades` - 成績登記
  - `GET /api/grades?courseId=xxx` - 獲取成績列表（可選按課程篩選）
  - `POST /api/grades` - 登記個人成績
    - 接受格式：`{ studentId: string, gradeItemId: string, score: number }`
- `POST /api/grades/group` - 分組成績登記
  - **批次為整組成員登記相同成績**
  - 接受格式：`{ groupId: string, gradeItemId: string, score: number }`
  - 返回影響的學生數量和詳細信息

### 專案結構
```
src/
├── app/
│   ├── api/          # API 路由
│   ├── students/     # 學生管理頁面
│   ├── groups/       # 分組管理頁面
│   ├── grade-items/  # 成績項目頁面
│   └── grades/       # 成績登記頁面
├── components/       # 共用元件
└── lib/             # 工具函式
```

## 部署說明

### 本地部署
1. 建構專案：`pnpm build`
2. 啟動服務：`pnpm start`

### Vercel 部署
1. 將專案推送至 GitHub
2. 在 Vercel 中導入專案
3. 設置環境變數 `DATABASE_URL`（Neon 連接字串）
4. 部署完成

### 注意事項
- 資料庫使用 Neon PostgreSQL 雲端服務
- 部署前請確保 `DATABASE_URL` 環境變數已正確設置
- Neon 免費額度足夠小型專案使用

---

**🤖 此專案由 Claude Code 自動生成**

建立時間：2025-09-12  
技術支援：[Claude Code Issues](https://github.com/anthropics/claude-code/issues)